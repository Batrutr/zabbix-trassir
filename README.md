# TRASSIR Server Monitoring Template для Zabbix

Шаблон для мониторинга состояния серверов видеонаблюдения TRASSIR через SDK API.

## Описание

Данный шаблон позволяет мониторить состояние сервера TRASSIR и его видеоканалов через HTTP API. Шаблон автоматически обнаруживает все видеоканалы на сервере и создает элементы данных для каждого канала.

## Возможности

### Общий мониторинг сервера
- **Health check** - состояние здоровья сервера TRASSIR
- **Список объектов** - получение списка всех объектов сервера
- **Количество каналов онлайн** - мониторинг количества активных каналов
- **Общее количество каналов** - общее количество каналов на сервере

### Автоматическое обнаружение каналов (LLD)
Шаблон автоматически обнаруживает все видеоканалы на сервере TRASSIR и для каждого канала создает следующие элементы данных:

#### Мониторинг состояния каналов
- **Signal Status** - наличие видеосигнала (Signal/No Signal)
- **Motion Detection** - обнаружение движения (Motion/No Motion)
- **Recording Status** - статус записи (Recording/Not Recording)

### Триггеры
- **No signal detected** - срабатывает при отсутствии сигнала на канале (приоритет: WARNING)

## Требования

- Zabbix Server версии 6.0 или выше
- TRASSIR Server с включенным SDK API
- Сетевой доступ от Zabbix Server к TRASSIR Server

## Установка

### 1. Импорт шаблона

1. Войдите в веб-интерфейс Zabbix
2. Перейдите в **Configuration** → **Templates**
3. Нажмите **Import**
4. Выберите файл `trassir_template.xml`
5. Нажмите **Import**

### 2. Создание узла сети (Host)

1. Перейдите в **Configuration** → **Hosts**
2. Нажмите **Create host**
3. Укажите имя узла сети
4. В поле **Groups** выберите или создайте группу
5. В разделе **Templates** выберите **TRASSIR Server**
6. Нажмите **Add**

### 3. Настройка макросов

После привязки шаблона к узлу сети необходимо настроить следующие макросы:

| Макрос | Описание | Значение по умолчанию | Пример |
|--------|----------|----------------------|---------|
| `{$TRASSIR.URL}` | URL сервера TRASSIR с портом | `https://192.168.1.200:8080` | `https://trassir.example.com:8080` |
| `{$TRASSIR.USERNAME}` | Имя пользователя TRASSIR | `Admin` | `monitoring` |
| `{$TRASSIR.PASSWORD}` | Пароль пользователя TRASSIR | `password` | `SecurePassword123` |

#### Как настроить макросы:

1. Перейдите к созданному узлу сети
2. Откройте вкладку **Macros**
3. Измените значения макросов на актуальные для вашего сервера TRASSIR
4. Нажмите **Update**

## Настройка TRASSIR Server

Для работы мониторинга необходимо включить SDK API на сервере TRASSIR:

1. Откройте настройки TRASSIR Server
2. Перейдите в раздел **Настройки** → **Общие**
3. Включите опцию **SDK**
4. Укажите порт для SDK API (по умолчанию 8080)
5. Создайте или используйте существующего пользователя с правами доступа к SDK
6. Сохраните настройки

## Мониторируемые метрики

### Элементы данных сервера

| Ключ | Описание | Тип | Интервал обновления |
|------|----------|------|---------------------|
| `trassir.objects` | Список всех объектов сервера | HTTP Agent | 1 минута |
| `trassir.health` | Состояние здоровья сервера | HTTP Agent | 30 секунд |
| `trassir.channels.online` | Количество каналов онлайн | Dependent | - |
| `trassir.channels.total` | Общее количество каналов | Dependent | - |

### Элементы данных канала (прототипы)

| Ключ | Описание | Тип | Интервал обновления |
|------|----------|------|---------------------|
| `trassir.channel.state[{#CHANNEL.GUID}]` | Полное состояние канала | HTTP Agent | 30 секунд |
| `trassir.channel.signal[{#CHANNEL.GUID}]` | Статус сигнала (1 - Signal, 0 - No Signal) | Dependent | - |
| `trassir.channel.motion[{#CHANNEL.GUID}]` | Обнаружение движения (1 - Motion, 0 - No Motion) | Dependent | - |
| `trassir.channel.recording[{#CHANNEL.GUID}]` | Статус записи (1 - Recording, 0 - Not Recording) | Dependent | - |

## Теги

Шаблон использует следующие теги для категоризации элементов данных:

- `component:trassir` - общие элементы TRASSIR
- `component:health` - элементы здоровья сервера
- `component:channels` - элементы каналов
- `component:signal` - элементы сигнала
- `component:motion` - элементы движения
- `component:recording` - элементы записи
- `channel:{#CHANNEL.NAME}` - привязка к конкретному каналу
- `scope:availability` - элементы доступности

## API Reference

Шаблон использует следующие эндпоинты TRASSIR SDK API:

- `GET /objects/` - получение списка всех объектов
- `GET /health` - проверка состояния здоровья сервера
- `GET /objects/{guid}` - получение информации о конкретном объекте (канале)

Формат запросов:
```
https://{server}:{port}/{endpoint}?username={user}&password={pass}
```